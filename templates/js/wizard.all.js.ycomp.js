var jg_ok,jg_ie,jg_fast,jg_dom,jg_moz;function _chkDHTM(C,A,B){A=C.document.body||null;jg_ie=A&&typeof A.insertAdjacentHTML!="undefined"&&C.document.createElement;jg_dom=(A&&!jg_ie&&typeof A.appendChild!="undefined"&&typeof C.document.createRange!="undefined"&&typeof (B=C.document.createRange()).setStartBefore!="undefined"&&typeof B.createContextualFragment!="undefined");jg_fast=jg_ie&&C.document.all&&!C.opera;jg_moz=jg_dom&&typeof A.style.MozOpacity!="undefined";jg_ok=!!(jg_ie||jg_dom)}function _pntCnvDom(){var A=this.wnd.document.createRange();A.setStartBefore(this.cnv);A=A.createContextualFragment(jg_fast?this._htmRpc():this.htm);if(this.cnv){this.cnv.appendChild(A)}this.htm=""}function _pntCnvIe(){if(this.cnv){this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this._htmRpc():this.htm)}this.htm=""}function _pntDoc(){this.wnd.document.write(jg_fast?this._htmRpc():this.htm);this.htm=""}function _pntN(){}function _mkDiv(A,D,B,C){this.htm+='<div style="position:absolute;left:'+A+"px;top:"+D+"px;width:"+B+"px;height:"+C+"px;clip:rect(0,"+B+"px,"+C+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}function _mkDivIe(A,D,B,C){this.htm+="%%"+this.color+";"+A+";"+D+";"+B+";"+C+";"}function _mkDivPrt(A,D,B,C){this.htm+='<div style="position:absolute;border-left:'+B+"px solid "+this.color+";left:"+A+"px;top:"+D+"px;width:0px;height:"+C+"px;clip:rect(0,"+B+"px,"+C+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}var _regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g;function _htmRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px"></div>\n')}function _htmPrtRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px;border-left:$4px solid $1"></div>\n')}function _mkLin(E,M,B,K){if(E>B){var J=B;var G=K;B=E;K=M;E=J;M=G}var P=B-E,O=Math.abs(K-M),L=E,I=M,N=(M>K)?-1:1;if(P>=O){var A=O<<1,H=A-(P<<1),D=A-P,F=L;while(P>0){--P;++L;if(D>0){this._mkDiv(F,I,L-F,1);I+=N;D+=H;F=L}else{D+=A}}this._mkDiv(F,I,B-F+1,1)}else{var A=P<<1,H=A-(O<<1),D=A-O,C=I;if(K<=M){while(O>0){--O;if(D>0){this._mkDiv(L++,I,1,C-I+1);I+=N;D+=H;C=I}else{I+=N;D+=A}}this._mkDiv(B,K,1,C-K+1)}else{while(O>0){--O;I+=N;if(D>0){this._mkDiv(L++,C,1,I-C);D+=H;C=I}else{D+=A}}this._mkDiv(B,C,1,K-C+1)}}}function _mkLin2D(Q,B,P,A){if(Q>P){var F=P;var N=A;P=Q;A=B;Q=F;B=N}var J=P-Q,I=Math.abs(A-B),H=Q,G=B,M=(B>A)?-1:1;var K=this.stroke;if(J>=I){if(J>0&&K-3>0){var R=(K*J*Math.sqrt(1+I*I/(J*J))-J-(K>>1)*I)/J;R=(!(K-4)?Math.ceil(R):Math.round(R))+1}else{var R=K}var S=Math.ceil(K/2);var O=I<<1,E=O-(J<<1),L=O-J,D=H;while(J>0){--J;++H;if(L>0){this._mkDiv(D,G,H-D+S,R);G+=M;L+=E;D=H}else{L+=O}}this._mkDiv(D,G,P-D+S+1,R)}else{if(K-3>0){var R=(K*I*Math.sqrt(1+J*J/(I*I))-(K>>1)*J-I)/I;R=(!(K-4)?Math.ceil(R):Math.round(R))+1}else{var R=K}var S=Math.round(K/2);var O=J<<1,E=O-(I<<1),L=O-I,C=G;if(A<=B){++S;while(I>0){--I;if(L>0){this._mkDiv(H++,G,R,C-G+S);G+=M;L+=E;C=G}else{G+=M;L+=O}}this._mkDiv(P,A,R,C-A+S)}else{while(I>0){--I;G+=M;if(L>0){this._mkDiv(H++,C,R,G-C+S);L+=E;C=G}else{L+=O}}this._mkDiv(P,C,R,A-C+S+1)}}}function _mkLinDott(D,K,B,I){if(D>B){var H=B;var E=I;B=D;I=K;D=H;K=E}var O=B-D,N=Math.abs(I-K),J=D,G=K,M=(K>I)?-1:1,L=true;if(O>=N){var A=N<<1,F=A-(O<<1),C=A-O;while(O>0){--O;if(L){this._mkDiv(J,G,1,1)}L=!L;if(C>0){G+=M;C+=F}else{C+=A}++J}}else{var A=O<<1,F=A-(N<<1),C=A-N;while(N>0){--N;if(L){this._mkDiv(J,G,1,1)}L=!L;G+=M;if(C>0){++J;C+=F}else{C+=A}}}if(L){this._mkDiv(J,G,1,1)}}function _mkOv(E,N,R,P){var V=(++R)>>1,U=(++P)>>1,L=R&1,D=P&1,C=E+V,B=N+U,I=0,H=U,G=0,F=U,Q=(V*V)<<1,O=Q<<1,M=(U*U)<<1,K=M<<1,S=(Q>>1)*(1-(U<<1))+M,A=(M>>1)-Q*((U<<1)-1),J,T;while(H>0){if(S<0){S+=M*((I<<1)+3);A+=K*(++I)}else{if(A<0){S+=M*((I<<1)+3)-O*(H-1);A+=K*(++I)-Q*(((H--)<<1)-3);J=I-G;T=F-H;if((J&2)&&(T&2)){this._mkOvQds(C,B,I-2,H+2,1,1,L,D);this._mkOvQds(C,B,I-1,H+1,1,1,L,D)}else{this._mkOvQds(C,B,I-1,F,J,T,L,D)}G=I;F=H}else{A-=Q*((H<<1)-3);S-=O*(--H)}}}J=V-G+1;T=(F<<1)+D;H=B-F;this._mkDiv(C-V,H,J,T);this._mkDiv(C+G+L-1,H,J,T)}function _mkOv2D(E,H,A,B){var e=this.stroke;A+=e+1;B+=e+1;var r=A>>1,p=B>>1,o=A&1,V=B&1,L=E+r,K=H+p,c=0,X=p,S=(r*r)<<1,Q=S<<1,G=(p*p)<<1,D=G<<1,I=(S>>1)*(1-(p<<1))+G,n=(G>>1)-S*((p<<1)-1);if(e-4<0&&(!(e-2)||A-51>0&&B-51>0)){var O=0,N=p,d,k,T;while(X>0){if(I<0){I+=G*((c<<1)+3);n+=D*(++c)}else{if(n<0){I+=G*((c<<1)+3)-Q*(X-1);n+=D*(++c)-S*(((X--)<<1)-3);d=c-O;k=N-X;if(d-1){T=d+1+(e&1);k=e}else{if(k-1){T=e;k+=1+(e&1)}else{T=k=e}}this._mkOvQds(L,K,c-1,N,T,k,o,V);O=c;N=X}else{n-=S*((X<<1)-3);I-=Q*(--X)}}}this._mkDiv(L-r,K-N,e,(N<<1)+V);this._mkDiv(L+r+o-e,K-N,e,(N<<1)+V)}else{var t=(A-(e<<1))>>1,q=(B-(e<<1))>>1,Y=0,W=q,R=(t*t)<<1,P=R<<1,F=(q*q)<<1,C=F<<1,J=(R>>1)*(1-(q<<1))+F,m=(F>>1)-R*((q<<1)-1),Z=new Array(),U=new Array(),f=new Array();Z[0]=0;U[0]=p;f[0]=q-1;while(X>0){if(I<0){Z[Z.length]=c;U[U.length]=X;I+=G*((c<<1)+3);n+=D*(++c)}else{if(n<0){Z[Z.length]=c;I+=G*((c<<1)+3)-Q*(X-1);n+=D*(++c)-S*(((X--)<<1)-3);U[U.length]=X}else{n-=S*((X<<1)-3);I-=Q*(--X)}}if(W>0){if(J<0){J+=F*((Y<<1)+3);m+=C*(++Y);f[f.length]=W-1}else{if(m<0){J+=F*((Y<<1)+3)-P*(W-1);m+=C*(++Y)-R*(((W--)<<1)-3);f[f.length]=W-1}else{m-=R*((W<<1)-3);J-=P*(--W);f[f.length-1]--}}}}var O=-o,N=p,M=f[0],g=Z.length,d,k;for(var j=0;j<g;j++){if(typeof f[j]!="undefined"){if(f[j]<M||U[j]<N){c=Z[j];this._mkOvQds(L,K,c,N,c-O,N-M,o,V);O=c;N=U[j];M=f[j]}}else{c=Z[j];this._mkDiv(L-c,K-N,1,(N<<1)+V);this._mkDiv(L+O+o,K-N,1,(N<<1)+V);O=c;N=U[j]}}this._mkDiv(L-r,K-N,1,(N<<1)+V);this._mkDiv(L+O+o,K-N,1,(N<<1)+V)}}function _mkOvDott(E,L,Q,O){var T=(++Q)>>1,S=(++O)>>1,J=Q&1,D=O&1,H=D^1,C=E+T,B=L+S,G=0,F=S,P=(T*T)<<1,M=P<<1,K=(S*S)<<1,I=K<<1,R=(P>>1)*(1-(S<<1))+K,A=(K>>1)-P*((S<<1)-1),N=true;while(F>0){if(R<0){R+=K*((G<<1)+3);A+=I*(++G)}else{if(A<0){R+=K*((G<<1)+3)-M*(F-1);A+=I*(++G)-P*(((F--)<<1)-3)}else{A-=P*((F<<1)-3);R-=M*(--F)}}if(N&&F>=H){this._mkOvQds(C,B,G,F,1,1,J,D)}N=!N}}function _mkRect(A,E,B,D){var C=this.stroke;this._mkDiv(A,E,B,C);this._mkDiv(A+B,E,C,D);this._mkDiv(A,E+D,B+C,C);this._mkDiv(A,E+C,C,D-C)}function _mkRectDott(A,D,B,C){this.drawLine(A,D,A+B,D);this.drawLine(A+B,D,A+B,D+C);this.drawLine(A,D+C,A+B,D+C);this.drawLine(A,D,A,D+C)}function jsgFont(){this.PLAIN="font-weight:normal;";this.BOLD="font-weight:bold;";this.ITALIC="font-style:italic;";this.ITALIC_BOLD=this.ITALIC+this.BOLD;this.BOLD_ITALIC=this.ITALIC_BOLD}var Font=new jsgFont();function jsgStroke(){this.DOTTED=-1}var Stroke=new jsgStroke();function jsGraphics(A,B){this.setColor=function(C){this.color=C.toLowerCase()};this.setStroke=function(C){this.stroke=C;if(!(C+1)){this.drawLine=_mkLinDott;this._mkOv=_mkOvDott;this.drawRect=_mkRectDott}else{if(C-1>0){this.drawLine=_mkLin2D;this._mkOv=_mkOv2D;this.drawRect=_mkRect}else{this.drawLine=_mkLin;this._mkOv=_mkOv;this.drawRect=_mkRect}}};this.setPrintable=function(C){this.printable=C;if(jg_fast){this._mkDiv=_mkDivIe;this._htmRpc=C?_htmPrtRpc:_htmRpc}else{this._mkDiv=C?_mkDivPrt:_mkDiv}};this.setFont=function(D,E,C){this.ftFam=D;this.ftSz=E;this.ftSty=C||Font.PLAIN};this.drawPolyline=this.drawPolyLine=function(C,E){for(var D=C.length-1;D;){--D;this.drawLine(C[D],E[D],C[D+1],E[D+1])}};this.fillRect=function(C,F,D,E){this._mkDiv(C,F,D,E)};this.drawPolygon=function(C,D){this.drawPolyline(C,D);this.drawLine(C[C.length-1],D[C.length-1],C[0],D[0])};this.drawEllipse=this.drawOval=function(C,F,D,E){this._mkOv(C,F,D,E)};this.fillEllipse=this.fillOval=function(G,Q,L,U){var X=L>>1,W=U>>1,M=L&1,F=U&1,E=G+X,D=Q+W,J=0,I=W,H=W,S=(X*X)<<1,R=S<<1,O=(W*W)<<1,K=O<<1,T=(S>>1)*(1-(W<<1))+O,C=(O>>1)-S*((W<<1)-1),P,N,V;if(L){while(I>0){if(T<0){T+=O*((J<<1)+3);C+=K*(++J)}else{if(C<0){T+=O*((J<<1)+3)-R*(I-1);P=E-J;N=(J<<1)+M;C+=K*(++J)-S*(((I--)<<1)-3);V=H-I;this._mkDiv(P,D-H,N,V);this._mkDiv(P,D+I+F,N,V);H=I}else{C-=S*((I<<1)-3);T-=R*(--I)}}}}this._mkDiv(E-X,D-H,L,(H<<1)+F)};this.fillArc=function(E,g,Z,I,F,U){var f=Z>>1,e=I>>1,Q=(Z&1)|((I&1)<<16),G=E+f,D=g+e,O=0,M=e,K=O,J=M,V=(f*f)<<1,T=V<<1,R=(e*e)<<1,P=R<<1,X=(V>>1)*(1-(e<<1))+R,C=(R>>1)-V*((e<<1)-1),Y,N,L,d,c=(1<<(Math.floor((F%=360)/180)<<3))|(2<<(Math.floor((U%=360)/180)<<3))|((F>=U)<<16),H=new Array(e+1),W=new Array(e+1);F*=Math.PI/180;U*=Math.PI/180;Y=G+Math.round(f*Math.cos(F));N=D+Math.round(-e*Math.sin(F));_mkLinVirt(H,G,D,Y,N);L=G+Math.round(f*Math.cos(U));d=D+Math.round(-e*Math.sin(U));_mkLinVirt(W,G,D,L,d);while(M>0){if(X<0){X+=R*((O<<1)+3);C+=P*(++O)}else{if(C<0){X+=R*((O<<1)+3)-T*(M-1);K=O;C+=P*(++O)-V*(((M--)<<1)-3);this._mkArcDiv(K,M,J,G,D,Q,H,W,c);J=M}else{C-=V*((M<<1)-3);X-=T*(--M);if(M&&(H[M]!=H[M-1]||W[M]!=W[M-1])){this._mkArcDiv(O,M,J,G,D,Q,H,W,c);K=O;J=M}}}}this._mkArcDiv(O,0,J,G,D,Q,H,W,c);if(Q>>16){if(c>>16){var S=(N<=D||d>D)?(G-O):G;this._mkDiv(S,D,O+G-S+(Q&65535),1)}else{if((c&1)&&d>D){this._mkDiv(G-O,D,O,1)}}}};this.fillPolygon=function(I,H){var J;var O;var Q,M;var D,P;var C,N;var L,K;var E;var F=I.length;if(!F){return }Q=H[0];M=H[0];for(J=1;J<F;J++){if(H[J]<Q){Q=H[J]}if(H[J]>M){M=H[J]}}for(O=Q;O<=M;O++){var G=new Array();E=0;for(J=0;J<F;J++){if(!J){L=F-1;K=0}else{L=J-1;K=J}P=H[L];N=H[K];if(P<N){D=I[L];C=I[K]}else{if(P>N){N=H[L];P=H[K];C=I[L];D=I[K]}else{continue}}if((O>=P)&&(O<N)){G[E++]=Math.round((O-P)*(C-D)/(N-P)+D)}else{if((O==M)&&(O>P)&&(O<=N)){G[E++]=Math.round((O-P)*(C-D)/(N-P)+D)}}}G.sort(_CompInt);for(J=0;J<E;J+=2){this._mkDiv(G[J],O,G[J+1]-G[J]+1,1)}}};this.drawString=function(D,C,E){this.htm+='<div style="position:absolute;white-space:nowrap;left:'+C+"px;top:"+E+"px;font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+D+"</div>"};this.drawStringRect=function(D,C,G,E,F){this.htm+='<div style="position:absolute;overflow:hidden;left:'+C+"px;top:"+G+"px;width:"+E+"px;text-align:"+F+";font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+D+"</div>"};this.drawImage=function(G,C,H,E,F,D){this.htm+='<div style="position:absolute;left:'+C+"px;top:"+H+"px;"+(E?("width:"+E+"px;"):"")+(F?("height:"+F+"px;"):"")+'"><img src="'+G+'"'+(E?(' width="'+E+'"'):"")+(F?(' height="'+F+'"'):"")+(D?(" "+D):"")+"></div>"};this.clear=function(){this.htm="";if(this.cnv){this.cnv.innerHTML=""}};this._mkOvQds=function(E,D,K,J,L,F,N,I){var G=E-K,C=E+K+N-L,M=D-J,H=D+J+I-F;if(C>G+L){this._mkDiv(C,M,L,F);this._mkDiv(C,H,L,F)}else{L=C-G+L}this._mkDiv(G,M,L,F);this._mkDiv(G,H,L,F)};this._mkArcDiv=function(O,N,D,H,G,E,L,K,Q){var C=H+O+(E&65535),M,I=D-N,J,F,P;if(!I){I=1}O=H-O;if(Q&16711680){M=G-N-I;if(Q&255){if(Q&2){J=Math.max(O,K[N]);P=C-J;if(P>0){this._mkDiv(J,M,P,I)}}if(Q&1){F=Math.min(C,L[N]);P=F-O;if(P>0){this._mkDiv(O,M,P,I)}}}else{this._mkDiv(O,M,C-O,I)}M=G+N+(E>>16);if(Q&65280){if(Q&256){J=Math.max(O,L[N]);P=C-J;if(P>0){this._mkDiv(J,M,P,I)}}if(Q&512){F=Math.min(C,K[N]);P=F-O;if(P>0){this._mkDiv(O,M,P,I)}}}else{this._mkDiv(O,M,C-O,I)}}else{if(Q&255){if(Q&2){J=Math.max(O,K[N])}else{J=O}if(Q&1){F=Math.min(C,L[N])}else{F=C}M=G-N-I;P=F-J;if(P>0){this._mkDiv(J,M,P,I)}}if(Q&65280){if(Q&256){J=Math.max(O,L[N])}else{J=O}if(Q&512){F=Math.min(C,K[N])}else{F=C}M=G+N+(E>>16);P=F-J;if(P>0){this._mkDiv(J,M,P,I)}}}};this.setStroke(1);this.setFont("verdana,geneva,helvetica,sans-serif","12px",Font.PLAIN);this.color="#000000";this.htm="";this.wnd=B||window;if(!jg_ok){_chkDHTM(this.wnd)}if(jg_ok){if(A){if(typeof (A)=="string"){this.cont=document.all?(this.wnd.document.all[A]||null):document.getElementById?(this.wnd.document.getElementById(A)||null):null}else{if(A==window.document){this.cont=document.getElementsByTagName("body")[0]}else{this.cont=A}}this.cnv=this.wnd.document.createElement("div");this.cnv.style.fontSize=0;this.cont.appendChild(this.cnv);this.paint=jg_dom?_pntCnvDom:_pntCnvIe}else{this.paint=_pntDoc}}else{this.paint=_pntN}this.setPrintable(false)}function _mkLinVirt(M,E,K,C,J){var P=Math.abs(C-E),O=Math.abs(J-K),L=E,I=K,A=(E>C)?-1:1,N=(K>J)?-1:1,D,F=0;if(P>=O){var B=O<<1,H=B-(P<<1);D=B-P;while(P>0){--P;if(D>0){M[F++]=L;I+=N;D+=H}else{D+=B}L+=A}}else{var B=P<<1,H=B-(O<<1);D=B-O;while(O>0){--O;I+=N;M[F++]=L;if(D>0){L+=A;D+=H}else{D+=B}}}for(var G=M.length,F=G-F;F;){M[G-(F--)]=L}}function _CompInt(A,B){return(A-B)}(function(){var A=false,B=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(G){var F=this.prototype;A=true;var E=new this();A=false;for(var D in G){E[D]=typeof G[D]=="function"&&typeof F[D]=="function"&&B.test(G[D])?(function(H,I){return function(){var K=this._super;this._super=F[H];var J=I.apply(this,arguments);this._super=K;return J}})(D,G[D]):G[D]}function C(){if(!A&&this.init){this.init.apply(this,arguments)}}C.prototype=E;C.constructor=C;C.extend=arguments.callee;return C}})();var areaClass=Class.extend({_id:-1,_link:-1,_label:"",_canvas:-1,_scale:1,_edges:true,_undoStack:new Array(),_redoStack:new Array(),_moreOptionsInitFlag:false,_moreOptionsVisible:false,_attr:{},_colors:["990033","ff9999","ffccff","993366","ff66cc","ff0066","ff00cc","cc0099","cc99ff","ff33ff","cc00cc","cc99cc","9933cc","9966cc","6600cc","663366","6633ff","9999ff","6666cc","333399","3333ff","3366ff","0000ff","336699","003366","0099cc","0099ff","66ffff","009999","33cccc","006666","33cc99","00ff99","669966","339933","33cc66","009933","ccff99","009900","00ff00","009900","66cc00","99cc66","669900","ccff00","333300","666633","ffff99","ffcc00","996600","993300","990000","ff3333","FF0000","ff6633","996633","cc9999","cc9966","eeeeee","999999","666666","333333","000000"],init:function(D,G,F,C,E,B,A){this._canvas=D;this._id=G;this._attr=(typeof A=="object")?A:{};this.setLabel(C);this.setLink(E);this.setColor(B);this.initCoords(F)},remove:function(){jQuery("#"+this.getFormId()).remove();this.getCanvas().removeArea(this.getId())},getCanvas:function(){return this._canvas},setLabel:function(A){this._label=A},getLabel:function(){return this._label},setLink:function(A){this._link=A},getLink:function(){return this._link},setScale:function(A){if(A<0||A>1){return }this._scale=A},applyScale:function(A,B){return((B)?this._scale:1)*parseInt(A)},reverseScale:function(A){return(1/this._scale)*parseInt(A)},_color:-1,setColor:function(A){this._color=((typeof A=="string")&&A.match(/^#\S{6}$/g))?A:("#"+this._colors[parseInt(Math.random()*57)])},updateColor:function(B,A){this.setColor(B);jQuery("#"+this.getFormId()+"_main > .colorPreview > div").css("backgroundColor",B);jQuery("#"+this.getFormId()+"_color > .colorBox > div").css("backgroundColor",B);if(A==1){this.getCanvas().updateCanvas(this.getId())}},getColor:function(){return this._color},drawEdge:function(B,A,C){if(!this._edges){return }B.setColor(this.getColor());B.fillRect(A-3,C-3,7,7);B.setColor("#ffffff");B.fillRect(A-2,C-2,5,5)},disableEdges:function(){this._edges=false},applyBasicAreaActions:function(){this._moreOptionsInitFlag=false;jQuery("#"+this.getFormId()+"_upd").data("area",this).click(function(B){var A=jQuery(this).data("area");A.pushUndoableAction();A.updateCoordsFromForm()});jQuery("#"+this.getFormId()+"_del").data("area",this).click(function(A){jQuery(this).data("area").remove()});jQuery("#"+this.getFormId()+" > .basicOptions > .exp > img").data("obj",this).data("rel","#"+this.getFormId()+" > .moreOptions").click(function(A){A.stopPropagation();if(!jQuery(this).data("obj").isMoreOptionsVisible()){jQuery(this).data("obj").applyAdditionalAreaActions();jQuery(jQuery(this).data("rel")).slideDown("fast")}else{jQuery(jQuery(this).data("rel")).slideUp("fast")}jQuery(this).data("obj").toogleMoreOptionsFlag()});jQuery("#"+this.getFormId()+" > .basicOptions > .colorPreview > div").data("pseudo","#"+this.getFormId()+" > .basicOptions > .exp > img:visible").click(function(A){jQuery(jQuery(this).data("pseudo")).trigger("click")});jQuery("#"+this.getFormId()+"_link").data("obj",this).change(function(A){jQuery(this).data("obj").updateStatesFromForm()});jQuery("#"+this.getFormId()+"_up").data("obj",this).click(function(A){jQuery(this).data("obj").getCanvas().areaUp(jQuery(this).data("obj").getId())});jQuery("#"+this.getFormId()+"_down").data("obj",this).click(function(A){jQuery(this).data("obj").getCanvas().areaDown(jQuery(this).data("obj").getId())});jQuery("#"+this.getFormId()+"_undo").data("obj",this).click(function(A){jQuery(this).data("obj").performUndo()});jQuery("#"+this.getFormId()+"_redo").data("obj",this).click(function(A){jQuery(this).data("obj").performRedo()});this.applyBasicTypeActions();if(!this._moreOptionsVisible){jQuery("#"+this.getFormId()+" > .moreOptions").hide()}else{this.applyAdditionalAreaActions()}this.updateColor(this.getColor(),0);this.changeUndoBtnStates();this.refreshExpandButtons()},updateStatesFromForm:function(){this.setLink(jQuery("<div/>").text(jQuery("#"+this.getFormId()+"_link").attr("value")).html());this.setLabel(jQuery("<div/>").text(jQuery("#"+this.getFormId()+"_label").attr("value")).html());var A=this;if(typeof this._attr!="object"){return }jQuery.each(this._attr,function(B,C){A._attr[B]=jQuery("<div/>").text(jQuery("#"+A.getFormId()+"_"+B).attr("value")).html()})},getCommonFormUpdateFields:function(){var A=this.getFormId()+'_link="'+this.getLink()+'";';A=A+this.getFormId()+'_label="'+this.getLabel()+'";';if(typeof this._attr=="object"){var B=this;jQuery.each(this._attr,function(C,D){A=A+B.getFormId()+"_"+C+'="'+D+'";'})}this.updateColor(this.getColor(),false);return A},getAdditionalAttributeXML:function(){var B='alt="'+this.getLabel().replace(/"/g,"&quot;")+'" color="'+this.getColor()+'"';var A=this;if(typeof this._attr!="object"){return }jQuery.each(this._attr,function(C,D){B=B+" "+C+'="'+A._attr[C].replace(/"/g,"&quot;")+'"'});return B},applyAdditionalAreaActions:function(){if(this._moreOptionsInitFlag==true){return }jQuery("#"+this.getFormId()+"_color > .colorPicker").data("area",this).simpleColor({colors:this._colors}).click(function(B,C){if(typeof C=="undefined"){return }var A=jQuery(this).data("area");A.pushUndoableAction();A.updateColor(C,1)});this.applyAdditionalTypeActions();this._moreOptionsInitFlag=true},refreshExpandButtons:function(){jQuery("#"+this.getFormId()+" > .basicOptions > .exp > img").hide();if(this.isMoreOptionsVisible()){jQuery("#"+this.getFormId()+" > .basicOptions > .exp > img.up").show()}else{jQuery("#"+this.getFormId()+" > .basicOptions > .exp > img.down").show()}},toogleMoreOptionsFlag:function(){this._moreOptionsVisible=!this._moreOptionsVisible;this.refreshExpandButtons()},isMoreOptionsVisible:function(){return this._moreOptionsVisible},getId:function(){return this._id},getFormId:function(){return this.getId()},performResizeAction:function(B,A,C){},hitOnObjectEdge:function(A,C,B){return -1},hitEdge:function(E,C,D,B,A){return((Math.abs(E-D)<=(A))&&(Math.abs(C-B)<=(A)))},performDragAction:function(B,A,C){},hitOnObjectBorder:function(A,C,B){return -1},hitBorder:function(C,H,A,G,E,D,K){var I=(K/2);var J=(C>A)?((E<=C+I)&&(E>=A-I)):((E>=C-I)&&(E<=A+I));var B=(H>G)?((D<=H+I)&&(D>=G-I)):((D>=H-I)&&(D<=G+I));if(J&&B){var F=(E*H+A*D+C*G-A*H-E*G-C*D)/Math.sqrt(Math.pow(A-C,2)+Math.pow(G-H,2));return(Math.abs(F)<(I))?true:false}return false},edgeWasHit:function(B,A,C){},borderWasHit:function(B,A,C){},pushUndoableAction:function(){this._undoStack.push(this.getUndoObject());this._redoStack.splice(0,this._redoStack.length);this.changeUndoBtnStates()},performUndo:function(){if(this._undoStack.length){var A=this._undoStack.pop();this._redoStack.push(this.getUndoObject());this.restoreFromUndoOject(A);this.getCanvas().updateForm(this.getId());this.getCanvas().updateCanvas(this.getId())}this.changeUndoBtnStates()},performRedo:function(){if(this._redoStack.length){var A=this._redoStack.pop();this._undoStack.push(this.getUndoObject());this.restoreFromUndoOject(A);this.getCanvas().updateForm(this.getId());this.getCanvas().updateCanvas(this.getId())}this.changeUndoBtnStates()},getUndoObject:function(){return{}},restoreFromUndoOject:function(A){},changeUndoBtnStates:function(){jQuery("#"+this.getFormId()+"_undo").css("visibility",(this._undoStack.length?"visible":"hidden"));jQuery("#"+this.getFormId()+"_redo").css("visibility",(this._redoStack.length?"visible":"hidden"))}});var canvasClass=Class.extend({canvasId:null,canvasVectors:null,pictureId:null,imageId:null,boxId:null,formsId:null,boxMarkerCount:null,areaCount:null,areaObjects:null,areaObjectList:null,formBlueprints:null,scaleFactor:1,imageOrigW:null,imageOrigH:null,mouseIsDown:false,mouseOverCanvas:false,mouseCurrentObjectDrag:-1,mouseCurrentEdgeDrag:-1,mouseCurrentBorderDrag:-1,mouseCurrentBorderDragX:-1,mouseCurrentBorderDragY:-1,init:function(C,A,B){if(C==undefined||A==undefined||B==undefined){return false}this.canvasId="#"+C;this.pictureId="#"+A;this.formsId="#"+B;this.boxMarkerCount=0;this.areaCount=0;this.canvasVectors=new Object();this.areaObjects=new Object();this.areaObjectList=new Array();this.imageOrigW=parseInt(jQuery(this.pictureId+" > #image > img").attr("width"));this.imageOrigH=parseInt(jQuery(this.pictureId+" > #image > img").attr("height"));this.formBlueprints=this.parseFormToBluePrint(this.formsId);jQuery(this.formsId).empty();this.setScale(1)},initializeScaling:function(B){var A=parseInt(B)/this.imageOrigW;var C=parseInt(B)/this.imageOrigH;return(A>C)?C:A},setScale:function(B){this.scaleFactor=((B>1)?1:B);jQuery(this.pictureId+" > #image > img").width(this.getMaxW());jQuery(this.pictureId+" > #image > img").height(this.getMaxH());jQuery(this.pictureId).width(this.getMaxW());jQuery(this.pictureId).height(this.getMaxH());var A=this;jQuery.each(this.areaObjectList,function(D,C){A.areaObjects[C].setScale(A.scaleFactor);A.updateCanvas(C)});jQuery(this.canvasId).width(this.getMaxW()).height(this.getMaxH())},mousedown:function(C){var A=C.pageX-jQuery(this.canvasId).offset().left;var D=C.pageY-jQuery(this.canvasId).offset().top;this.mouseIsDown=true;var B=this;jQuery.each(jQuery(this.formsId+" > div"),function(F,G){if((B.mouseCurrentObjectDrag==-1)&&(B.mouseCurrentEdgeDrag==-1)){var E=B.areaObjects[jQuery(this).attr("id")].hitOnObjectEdge(A,D,3);if(E!=-1){B.areaObjects[jQuery(this).attr("id")].pushUndoableAction();B.mouseCurrentObjectDrag=jQuery(this).attr("id");B.mouseCurrentEdgeDrag=E;C.stopPropagation()}}if((B.mouseCurrentObjectDrag==-1)&&(B.mouseCurrentBorderDrag==-1)){var E=B.areaObjects[jQuery(this).attr("id")].hitOnObjectBorder(A,D,5);if(E!=-1){B.areaObjects[jQuery(this).attr("id")].pushUndoableAction();B.mouseCurrentObjectDrag=jQuery(this).attr("id");B.mouseCurrentBorderDrag=E;B.mouseCurrentBorderDragX=A;B.mouseCurrentBorderDragY=D;C.stopPropagation()}}});return false},mouseup:function(A){this.mouseIsDown=false;this.mouseCurrentObjectDrag=-1;this.mouseCurrentEdgeDrag=-1;this.mouseCurrentBorderDrag=-1},mousemove:function(B){var A=B.pageX-jQuery(this.canvasId).offset().left;var C=B.pageY-jQuery(this.canvasId).offset().top;this.mouseOverCanvas=true;if(A<0){A=0;this.mouseOverCanvas=false}if(A>this.getMaxW()){A=this.getMaxW();this.mouseOverCanvas=false}if(C<0){C=0;this.mouseOverCanvas=false}if(C>this.getMaxH()){C=this.getMaxH();this.mouseOverCanvas=false}if((this.mouseCurrentObjectDrag!=-1)&&(this.mouseCurrentEdgeDrag!=-1)){this.mouseCurrentEdgeDrag=this.areaObjects[this.mouseCurrentObjectDrag].performResizeAction(this.mouseCurrentEdgeDrag,A,C);this.updateCanvas(this.mouseCurrentObjectDrag);this.updateForm(this.mouseCurrentObjectDrag);B.stopPropagation()}else{if((this.mouseCurrentObjectDrag!=-1)&&(this.mouseCurrentBorderDrag!=-1)){this.mouseCurrentBorderDrag=this.areaObjects[this.mouseCurrentObjectDrag].performDragAction(this.mouseCurrentBorderDrag,A-this.mouseCurrentBorderDragX,C-this.mouseCurrentBorderDragY);this.mouseCurrentBorderDragX=A;this.mouseCurrentBorderDragY=C;this.updateCanvas(this.mouseCurrentObjectDrag);this.updateForm(this.mouseCurrentObjectDrag);B.stopPropagation()}}return false},dblclick:function(C){var A=C.pageX-jQuery(this.canvasId).offset().left;var D=C.pageY-jQuery(this.canvasId).offset().top;var B=this;jQuery.each(jQuery(this.formsId+" > div"),function(F,G){var E=B.areaObjects[jQuery(this).attr("id")].hitOnObjectEdge(A,D,3);if(E!=-1){if(B.areaObjects[jQuery(this).attr("id")].edgeWasHit(E)){B.updateCanvas(jQuery(this).attr("id"));B.updateForm(jQuery(this).attr("id"))}}var E=B.areaObjects[jQuery(this).attr("id")].hitOnObjectBorder(A,D,5);if(E!=-1){if(B.areaObjects[jQuery(this).attr("id")].borderWasHit(E,A,D)){B.updateCanvas(jQuery(this).attr("id"));B.updateForm(jQuery(this).attr("id"))}}})},addArea:function(G,F,C,E,D,B,A){if(F==""){F=G.getStartupCoords(this.getCenterCoords(),this.getDimensions())}G.init(this,this.getNextId(),F,C,E,D,A);G.setScale(this.scaleFactor);this.areaObjects[G.getId()]=G;this.areaObjectList.push(G.getId());if(B){jQuery(this.formsId).prepend(G.formMarkup().replace(/OBJID/g,G.getId()))}else{jQuery(this.formsId).append(G.formMarkup().replace(/OBJID/g,G.getId()))}jQuery(this.formsId).data("parent",this).sortable({distance:3,start:function(H){jQuery("#"+jQuery(H.target).attr("id")+" > .sortbtn").css("visibility","hidden");jQuery("#"+jQuery(H.target).attr("id")+" > div > .sortbtn").css("visibility","hidden")},stop:function(H){jQuery(this).data("parent").updateCanvasLayerOrder();jQuery(this).data("parent").fixSortbtnVisibility()}});this.areaObjects[G.getId()].applyBasicAreaActions();this.updateForm(G.getId());this.addCanvasLayer(G.getId());this.updateCanvas(G.getId());this.updateCanvasLayerOrder();this.fixSortbtnVisibility()},removeArea:function(B){var A=new Array();jQuery.each(this.areaObjectList,function(D,C){if(C!=B){A.push(C)}});this.areaObjectList=A;this.removeCanvasLayer(B);this.fixSortbtnVisibility()},areaUp:function(C){var B=-1;var A=-1;jQuery.each(jQuery(this.formsId+" > div"),function(D,E){if(jQuery(E).attr("id")==C){A=jQuery(E).attr("id")}if(A==-1){B=jQuery(E).attr("id")}});if(B!=-1){jQuery("#"+A).insertBefore("#"+B);this.updateCanvasLayerOrder()}this.fixSortbtnVisibility()},areaDown:function(C){var B=-1;var A=-1;jQuery.each(jQuery(this.formsId+" > div"),function(D,E){if((A!=-1)&&(B==-1)){B=jQuery(E).attr("id")}if(jQuery(E).attr("id")==C){A=jQuery(E).attr("id")}});if(B!=-1){jQuery("#"+A).insertAfter("#"+B);this.updateCanvasLayerOrder()}this.fixSortbtnVisibility()},getCenterCoords:function(){return{x:(this.imageOrigW/2),y:(this.imageOrigH/2)}},getDimensions:function(){return{w:this.imageOrigW,h:this.imageOrigH}},fixSortbtnVisibility:function(){jQuery(this.formsId+" > div > .basicOptions > .sortbtn").css("visibility","visible");jQuery(this.formsId+" > div:first > .basicOptions > .upbtn").css("visibility","hidden");jQuery(this.formsId+" > div:last > .basicOptions > .downbtn").css("visibility","hidden")},persistanceXML:function(){var A="";var B=new Array();var C=this;jQuery.each(jQuery(this.formsId+" > div"),function(D,E){if(typeof C.areaObjects[jQuery(E).attr("id")]!="undefined"){C.areaObjects[jQuery(E).attr("id")].updateStatesFromForm();A=A+"\n"+C.areaObjects[jQuery(E).attr("id")].persistanceXML()}});return A},addCanvasLayer:function(A){jQuery(this.canvasId).append('<div id="'+A+'_canvas" class="canvas"><!-- --></div>');this.canvasVectors[A]=new jsGraphics(A+"_canvas")},updateCanvas:function(A){this.canvasVectors[A].clear();this.areaObjects[A].drawSelection(this.canvasVectors[A]);this.canvasVectors[A].paint()},removeCanvasLayer:function(A){this.canvasVectors[A].clear();jQuery("#"+A+"_canvas").remove()},updateCanvasLayerOrder:function(){var B=100;var A=this;jQuery.each(jQuery(this.formsId+" > div"),function(C,D){if(typeof A.areaObjects[jQuery(D).attr("id")]!="undefined"){jQuery("#"+jQuery(D).attr("id")+"_canvas").css("z-index",B--)}})},updateForm:function(B){var A=this.areaObjects[B].formUpdate();jQuery.each(A.split('";'),function(D,E){var C=E.split('="');if(C[0]){jQuery("#"+C[0]).attr("value",C[1])}})},refreshForm:function(A){this.areaObjects[A].updateStatesFromForm();jQuery("#"+this.areaObjects[A].getFormId()).replaceWith(this.areaObjects[A].formMarkup().replace(/OBJID/g,A));this.areaObjects[A].applyBasicAreaActions(jQuery("#"+A));this.updateForm(this.areaObjects[A].getId())},triggerAreaLinkUpdate:function(A){this.refreshForm(A)},getNextId:function(){this.areaCount=this.areaCount+1;return"Object"+this.areaCount},getNextMarkerPointId:function(){this.boxMarkerCount=this.boxMarkerCount+1;return"markerPoint"+this.boxMarkerCount},getFormBlueprint:function(A){return this.formBlueprints[A]},parseFormToBluePrint:function(B){var A=new Array();jQuery(B+" > div").each(function(C){if(jQuery(this).attr("class")=="noIdWrap"){A[this.id]=jQuery("#"+this.id).html()}else{A[this.id]='<div class="'+this.id+" "+jQuery(this).attr("class")+'" id="MAPFORMID">'+jQuery("#"+this.id).html()+"</div>"}});return A},getMaxW:function(){return this.scaleFactor*this.imageOrigW},getMaxH:function(){return this.scaleFactor*this.imageOrigH}});var areaCircleClass=areaClass.extend({_coords:-1,_undoStack:new Array(),_redoStack:new Array(),initCoords:function(B){if(typeof B=="undefined"){return }this._coords=new Array();var A=B.split(",");this.setX(A[0]);this.setY(A[1]);this.setRadius(A[2])},getStartupCoords:function(D,C){var A=(C.w>200)?100:(C.w/2);var B=(C.h>200)?100:(C.h/2);return D.x+","+D.y+","+((A>B)?B/2:A/2)},persistanceXML:function(){return'<area shape="circle" coords="'+this.getX(0)+","+this.getY(0)+","+this.getRadius(0)+'" '+this.getAdditionalAttributeXML()+">"+this.getLink()+"</area>"},drawSelection:function(A){A.setColor(this.getColor());A.setStroke(1);A.drawEllipse(this.getX(1)-this.getRadius(1),this.getY(1)-this.getRadius(1),2*this.getRadius(1),2*this.getRadius(1));this.drawEdge(A,this.getX(1),this.getY(1));if((this.getX(1)-this.getRadius(1))>0){this.drawEdge(A,this.getX(1)-this.getRadius(1),this.getY(1))}if((this.getX(1)+this.getRadius(1))<this.getCanvas().getMaxW()){this.drawEdge(A,this.getX(1)+this.getRadius(1),this.getY(1))}if((this.getY(1)-this.getRadius(1))>0){this.drawEdge(A,this.getX(1),this.getY(1)-this.getRadius(1))}if((this.getY(1)+this.getRadius(1))<this.getCanvas().getMaxH()){this.drawEdge(A,this.getX(1),this.getY(1)+this.getRadius(1))}},formMarkup:function(A){return this.getCanvas().getFormBlueprint("circForm").replace(/MAPFORMID/g,this.getFormId()).replace(/MAPAREAVALUE_URL/g,escape(this.getLink())).replace(/MAPAREAVALUE/g,this.getLink())},formUpdate:function(){var A=this.getFormId()+'_x="'+this.getX(0)+'";'+this.getFormId()+'_y="'+this.getY(0)+'";'+this.getFormId()+'_radius="'+this.getRadius(0)+'";';A=A+this.getCommonFormUpdateFields();return A},applyBasicTypeActions:function(){},applyAdditionalTypeActions:function(){},updateCoordsFromForm:function(A){this.setX(parseInt(jQuery("#"+this.getFormId()+"_x").val()));this.setY(parseInt(jQuery("#"+this.getFormId()+"_y").val()));this.setRadius(parseInt(jQuery("#"+this.getFormId()+"_radius").val()));this.getCanvas().updateCanvas(this.getId())},hitOnObjectEdge:function(D,C,B){var A=-1;if(this.hitEdge(D,C,this.getX(1),this.getY(1),B)){A=0}else{if(this.hitEdge(D,C,this.getX(1)-this.getRadius(1),this.getY(1),B)){A=1}else{if(this.hitEdge(D,C,this.getX(1)+this.getRadius(1),this.getY(1),B)){A=2}else{if(this.hitEdge(D,C,this.getX(1),this.getY(1)-this.getRadius(1),B)){A=3}else{if(this.hitEdge(D,C,this.getX(1),this.getY(1)+this.getRadius(1),B)){A=4}}}}}return A},performResizeAction:function(B,E,C){var A=this.reverseScale(E);var D=this.reverseScale(C);if(B==0){this.setX(A);this.setY(D)}else{if(B==1||B==2){this.setRadius(this.getX(0)-A)}else{if(B==3||B==4){this.setRadius(this.getY(0)-D)}}}return B},performDragAction:function(C,B,A){this.setX(this.getX(0)+this.reverseScale(B));this.setY(this.getY(0)+this.reverseScale(A));return C},hitOnObjectBorder:function(B,D,C){var A=-1;if(this.hitBorder(this.getX(1),this.getY(1),this.getRadius(1),this.getRadius(1),B,D,C)){A=1}return A},hitBorder:function(C,E,B,A,G,F,D){var H=Math.sqrt(Math.pow(G-C,2)+Math.pow(F-E,2));return(Math.abs(H)<(B+(D/2))&&Math.abs(H)>(B-(D/2)))?true:false},getX:function(A){return this.applyScale(this._coords[0],A)},setX:function(A){this._coords[0]=parseInt(A)},getY:function(A){return this.applyScale(this._coords[1],A)},setY:function(A){this._coords[1]=parseInt(A)},getRadius:function(A){return this.applyScale(this._coords[2],A)},setRadius:function(A){this._coords[2]=Math.abs(parseInt(A))},getUndoObject:function(){return{color:this.getColor(),x:this.getX(false),y:this.getY(false),radius:this.getRadius(false)}},restoreFromUndoOject:function(A){this.setColor(A.color);this.setX(A.x);this.setY(A.y);this.setRadius(A.radius)}});var areaPolyClass=areaClass.extend({_coords:-1,_undoStack:new Array(),_redoStack:new Array(),initCoords:function(C){if(typeof C=="undefined"){return }this._coords=new Array();var B=C.split(",");for(var A=0;A<B.length;A=A+2){this.addCoord(B[A],B[A+1],false)}},getStartupCoords:function(D,C){var A=(C.w>200)?100:(C.w/2);var B=(C.h>200)?100:(C.h/2);return D.x+","+(D.y-(B/2))+","+(D.x-(A/2))+","+(D.y+(B/2))+","+(D.x+(A/2))+","+(D.y+(B/2))},persistanceXML:function(){return'<area shape="poly" coords="'+this.joinCoords()+'" '+this.getAdditionalAttributeXML()+">"+this.getLink()+"</area>"},drawSelection:function(C){C.setStroke(1);for(var E=0;E<this._coords.length;E++){var B=this._coords[E].x;var F=this._coords[E].y;var A=this._coords[((E>0)?E:this._coords.length)-1].x;var D=this._coords[((E>0)?E:this._coords.length)-1].y;C.setColor(this.getColor());C.drawLine(this.applyScale(B,1),this.applyScale(F,1),this.applyScale(A,1),this.applyScale(D,1))}for(var E=0;E<this._coords.length;E++){this.drawEdge(C,this.applyScale(this._coords[E].x,1),this.applyScale(this._coords[E].y,1))}},formMarkup:function(A){return this.getCanvas().getFormBlueprint("polyForm").replace(/MAPFORMID/g,this.getFormId()).replace(/MAPAREAVALUE_URL/g,escape(this.getLink())).replace(/MAPAREAVALUE/g,this.getLink()).replace(/POLYCOORDS/g,this.coordMarkup())},coordMarkup:function(){var A="";var C=this.getCanvas().getFormBlueprint("polyCoords");for(var B=0;B<this._coords.length;B++){A=A+C.replace(/MAPFORMID/g,this.getFormId()).replace(/vN/g,B).replace(/vX/g,this._coords[B].x).replace(/vY/g,this._coords[B].y)}return A},formUpdate:function(){var A="";for(var B=0;B<this._coords.length;B++){A=A+this.getFormId()+"_x"+B+'="'+parseInt(this._coords[B].x)+'";';A=A+this.getFormId()+"_y"+B+'="'+parseInt(this._coords[B].y)+'";'}A=A+this.getCommonFormUpdateFields();return A},applyBasicTypeActions:function(){jQuery("#"+this.getFormId()+"_add").data("obj",this).click(function(A){jQuery(this).data("obj").insertNewCoordAfterPoint(-1)})},applyAdditionalTypeActions:function(){jQuery("#"+this.getFormId()+"_more > .positionOptions > .addCoord").data("obj",this).click(function(A){if(this.id.match(/^.*_after\d+$/)){jQuery(this).data("obj").insertNewCoordAfterPoint(parseInt(this.id.replace(/^.*_after/g,"")))}if(this.id.match(/^.*_before\d+$/)){jQuery(this).data("obj").insertNewCoordBeforePoint(parseInt(this.id.replace(/^.*_before/g,"")))}});jQuery("#"+this.getFormId()+"_more > .positionOptions > .rmCoord").data("obj",this).click(function(A){jQuery(this).data("obj").removeCoord(parseInt(this.id.replace(/^.*_rm/g,"")))})},updateCoordsFromForm:function(B){for(var A=0;A<this._coords.length;A++){this._coords[A].x=parseInt(jQuery("#"+this.getFormId()+"_x"+A).val());this._coords[A].y=parseInt(jQuery("#"+this.getFormId()+"_y"+A).val())}this.getCanvas().updateCanvas(this.getId())},hitOnObjectEdge:function(E,C,B){var A=-1;for(var D=0;D<this._coords.length;D++){if((A==-1)&&this.hitEdge(E,C,this.applyScale(this._coords[D].x,1),this.applyScale(this._coords[D].y,1),B)){A=D}}return A},performResizeAction:function(B,E,C){var A=this.reverseScale(E);var D=this.reverseScale(C);if(B>=0&&B<this._coords.length){this._coords[B].x=A;this._coords[B].y=D}return B},hitOnObjectBorder:function(F,E,D){var A=-1;for(var C=0;C<this._coords.length;C++){var B=((C+1)==this._coords.length)?0:C+1;if((A==-1)&&this.hitBorder(this.applyScale(this._coords[C].x,1),this.applyScale(this._coords[C].y,1),this.applyScale(this._coords[B].x,1),this.applyScale(this._coords[B].y,1),F,E,D)){A=C}}return A},performDragAction:function(C,B,A){for(var D=0;D<this._coords.length;D++){this._coords[D].x=this._coords[D].x+this.reverseScale(B);this._coords[D].y=this._coords[D].y+this.reverseScale(A)}return C},edgeWasHit:function(A){this.removeCoord(A);return true},borderWasHit:function(B,A,C){this._coords.splice(B+1,0,{x:this.reverseScale(A),y:this.reverseScale(C)});this.getCanvas().updateCanvas(this.getId());this.getCanvas().refreshForm(this.getId());return true},addCoord:function(B,A){this._coords.push({x:parseInt(B),y:parseInt(A)})},insertNewCoordAfterPoint:function(C){var E,B,A;A=this._coords.length-1;if(C==-1||C>=A){E=0;B=A}else{E=C;B=C+1}var F=(this._coords[E].x+this._coords[B].x)/2;var D=(this._coords[E].y+this._coords[B].y)/2;if(E==0&&B==A){this.addCoord(F,D)}else{this._coords.splice(B,0,{x:parseInt(F),y:parseInt(D)})}this.getCanvas().updateCanvas(this.getId());this.getCanvas().refreshForm(this.getId())},insertNewCoordBeforePoint:function(A){this.insertNewCoordAfterPoint(A-1)},removeCoord:function(A){if(this._coords.length>3){this._coords.splice(A,1);this.getCanvas().updateCanvas(this.getId());this.getCanvas().refreshForm(this.getId())}else{alert("Polygone needs to have at least 3 Edges")}},joinCoords:function(){var A="";for(var B=0;B<this._coords.length;B++){A=A+(A.length?",":"")+parseInt(this._coords[B].x)+","+parseInt(this._coords[B].y)}return A},getUndoObject:function(){return{color:this.getColor(),coords:this.joinCoords()}},restoreFromUndoOject:function(A){this.setColor(A.color);this.initCoords(A.coords)}});var areaRectClass=areaClass.extend({_coords:-1,_undoStack:new Array(),_redoStack:new Array(),initCoords:function(B){if(typeof B=="undefined"){return }this._coords=new Array();var A=B.split(",");this.setX(A[0],A[2]);this.setY(A[1],A[3])},getStartupCoords:function(D,C){var A=(C.w>200)?100:(C.w/2);var B=(C.h>200)?100:(C.h/2);return(D.x-(A/2))+","+(D.y-(B/2))+","+(D.x+(A/2))+","+(D.y+(B/2))},persistanceXML:function(){return'<area shape="rect" coords="'+this.getLeftX(0)+","+this.getTopY(0)+","+this.getRightX(0)+","+this.getBottomY(0)+'" '+this.getAdditionalAttributeXML()+">"+this.getLink()+"</area>"},drawSelection:function(A){A.setColor(this.getColor());A.setStroke(1);A.drawRect(this.getLeftX(1),this.getTopY(1),this.getWidth(1),this.getHeight(1));this.drawEdge(A,this.getLeftX(1),this.getTopY(1));this.drawEdge(A,this.getRightX(1),this.getTopY(1));this.drawEdge(A,this.getRightX(1),this.getBottomY(1));this.drawEdge(A,this.getLeftX(1),this.getBottomY(1))},formMarkup:function(A){return this.getCanvas().getFormBlueprint("rectForm").replace(/MAPFORMID/g,this.getFormId()).replace(/MAPAREAVALUE_URL/g,escape(this.getLink())).replace(/MAPAREAVALUE/g,this.getLink())},formUpdate:function(){var A=this.getFormId()+'_x1="'+this.getLeftX(0)+'";'+this.getFormId()+'_y1="'+this.getTopY(0)+'";'+this.getFormId()+'_x2="'+this.getRightX(0)+'";'+this.getFormId()+'_y2="'+this.getBottomY(0)+'";';A=A+this.getCommonFormUpdateFields();return A},applyBasicTypeActions:function(){},applyAdditionalTypeActions:function(){},updateCoordsFromForm:function(A){this.setX(parseInt(jQuery("#"+this.getFormId()+"_x1").val()),parseInt(jQuery("#"+this.getFormId()+"_x2").val()));this.setY(parseInt(jQuery("#"+this.getFormId()+"_y1").val()),parseInt(jQuery("#"+this.getFormId()+"_y2").val()));this.getCanvas().updateCanvas(this.getId())},hitOnObjectEdge:function(D,C,B){var A=-1;if(this.hitEdge(D,C,this.getLeftX(1),this.getTopY(1),B)){A=0}else{if(this.hitEdge(D,C,this.getRightX(1),this.getTopY(1),B)){A=1}else{if(this.hitEdge(D,C,this.getRightX(1),this.getBottomY(1),B)){A=2}else{if(this.hitEdge(D,C,this.getLeftX(1),this.getBottomY(1),B)){A=3}}}}return A},performResizeAction:function(B,H,G){var I=this.reverseScale(H);var F=this.reverseScale(G);var D=this.getLeftX(0);var C=this.getTopY(0);var E=this.getWidth(0);var A=this.getHeight(0);if(B==0||B==3){E=E-(I-D)}if(B==0||B==1){A=A-(F-C)}if(B==2||B==1){E=I-D}if(B==2||B==3){A=F-C}if(B==0||B==3){D=I}if(B==0||B==1){C=F}if(E<0){D=D+E;E=-E;if(B==0){B=1}else{if(B==1){B=0}else{if(B==2){B=3}else{if(B==3){B=2}}}}}if(A<0){C=C+A;A=-A;if(B==0){B=3}else{if(B==1){B=2}else{if(B==2){B=1}else{if(B==3){B=0}}}}}this.setX(D,D+E);this.setY(C,C+A);return B},hitOnObjectBorder:function(D,C,B){var A=-1;if(this.hitBorder(this.getLeftX(1),this.getTopY(1),this.getRightX(1),this.getTopY(1),D,C,B)){A=1}if(this.hitBorder(this.getRightX(1),this.getTopY(1),this.getRightX(1),this.getBottomY(1),D,C,B)){A=2}if(this.hitBorder(this.getLeftX(1),this.getBottomY(1),this.getRightX(1),this.getBottomY(1),D,C,B)){A=3}if(this.hitBorder(this.getLeftX(1),this.getTopY(1),this.getLeftX(1),this.getBottomY(1),D,C,B)){A=4}return A},performDragAction:function(D,C,B){var A=this.getLeftX(0);var G=this.getTopY(0);var F=this.reverseScale(C);var E=this.reverseScale(B);this.setX(A+F,A+F+this.getWidth(0));this.setY(G+E,G+E+this.getHeight(0));return D},getLeftX:function(A){return this.applyScale(this._coords[0],A)},getTopY:function(A){return this.applyScale(this._coords[1],A)},getRightX:function(A){return this.applyScale(this._coords[2],A)},getBottomY:function(A){return this.applyScale(this._coords[3],A)},getWidth:function(A){return this.applyScale(this.getRightX(0)-this.getLeftX(0),A)},getHeight:function(A){return this.applyScale(this.getBottomY(0)-this.getTopY(0),A)},setX:function(B,A){this._coords[0]=parseInt(parseInt(B)>parseInt(A)?A:B);this._coords[2]=parseInt(parseInt(B)>parseInt(A)?B:A)},setY:function(B,A){this._coords[1]=parseInt(parseInt(B)>parseInt(A)?A:B);this._coords[3]=parseInt(parseInt(B)>parseInt(A)?B:A)},setW:function(B){var A=this.getLeftX(0);this.setX(A,A+B)},setH:function(A){var B=this.getTopY(0);this.setY(B,B+A)},getUndoObject:function(){return{color:this.getColor(),x1:this._coords[0],x2:this._coords[2],y1:this._coords[1],y2:this._coords[3]}},restoreFromUndoOject:function(A){this.setColor(A.color);this.setX(A.x1,A.x2);this.setY(A.y1,A.y2)}});var previewCanvasClass=Class.extend({canvasId:null,canvasVectors:null,areaCount:null,areaObjects:null,areaObjectList:null,scale:null,init:function(B,A){this.canvasId="#"+B;this.scale=A;this.canvasVectors=new jsGraphics(B);this.areaCount=0;this.areaObjects=new Array();this.areaObjectList=new Array()},addArea:function(F,E,B,D,C,A){F.init(this,this.getNextId(),E,B,D,C,{});F.disableEdges();F.setScale(this.scale);this.areaObjects[F.getId()]=F;if(A){this.areaObjectList.push(F.getId())}else{this.areaObjectList.unshift(F.getId())}this.updateCanvas()},updateCanvas:function(){this.canvasVectors.clear();var A=this;jQuery.each(this.areaObjectList,function(C,B){A.areaObjects[B].drawSelection(A.canvasVectors)});this.canvasVectors.paint()},getNextId:function(){this.areaCount=this.areaCount+1;return"Object"+this.areaCount},getMaxW:function(){return jQuery(this.canvasId).width()},getMaxH:function(){return jQuery(this.canvasId).height()}});(function(A){A.fn.simpleColor=function(B){var C=["990033","ff3366","cc0033","ff0033","ff9999","cc3366","ffccff","cc6699","993366","660033","cc3399","ff99cc","ff66cc","ff99ff","ff6699","cc0066","ff0066","ff3399","ff0099","ff33cc","ff00cc","ff66ff","ff33ff","ff00ff","cc0099","990066","cc66cc","cc33cc","cc99ff","cc66ff","cc33ff","993399","cc00cc","cc00ff","9900cc","990099","cc99cc","996699","663366","660099","9933cc","660066","9900ff","9933ff","9966cc","330033","663399","6633cc","6600cc","9966ff","330066","6600ff","6633ff","ccccff","9999ff","9999cc","6666cc","6666ff","666699","333366","333399","330099","3300cc","3300ff","3333ff","3333cc","0066ff","0033ff","3366ff","3366cc","000066","000033","0000ff","000099","0033cc","0000cc","336699","0066cc","99ccff","6699ff","003366","6699cc","006699","3399cc","0099cc","66ccff","3399ff","003399","0099ff","33ccff","00ccff","99ffff","66ffff","33ffff","00ffff","00cccc","009999","669999","99cccc","ccffff","33cccc","66cccc","339999","336666","006666","003333","00ffcc","33ffcc","33cc99","00cc99","66ffcc","99ffcc","00ff99","339966","006633","336633","669966","66cc66","99ff99","66ff66","339933","99cc99","66ff99","33ff99","33cc66","00cc66","66cc99","009966","009933","33ff66","00ff66","ccffcc","ccff99","99ff66","99ff33","00ff33","33ff33","00cc33","33cc33","66ff33","00ff00","66cc33","006600","003300","009900","33ff00","66ff00","99ff00","66cc00","00cc00","33cc00","339900","99cc66","669933","99cc33","336600","669900","99cc00","ccff66","ccff33","ccff00","999900","cccc00","cccc33","333300","666600","999933","cccc66","666633","999966","cccc99","ffffcc","ffff99","ffff66","ffff33","ffff00","ffcc00","ffcc66","ffcc33","cc9933","996600","cc9900","ff9900","cc6600","993300","cc6633","663300","ff9966","ff6633","ff9933","ff6600","cc3300","996633","330000","663333","996666","cc9999","993333","cc6666","ffcccc","ff3333","cc3333","ff6666","660000","990000","cc0000","ff0000","ff3300","cc9966","ffcc99","ffffff","cccccc","999999","666666","333333","000000","000000","000000","000000","000000","000000","000000","000000","000000"];B=A.extend({colors:this.attr("colors")||C,indicator:this.attr("indicator")||null},B||{});A.simpleColorOptions=B;this.each(function(F){var E=A.simpleColorOptions;for(var G=0;G<E.colors.length;G++){var D=A("<div class='colorPickerCell' id='"+E.colors[G]+"'/>");D.css("backgroundColor","#"+E.colors[G]);A(this).append(D);var H={color:"#"+E.colors[G]};D.data("parent",this).bind("click",H,function(I){if(typeof I.data!="undefined"){A(A(this).data("parent")).trigger("click",[I.data.color])}})}A(this).append('<br style="clear:both">')});return this}})(jQuery);